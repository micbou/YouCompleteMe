language: generic
sudo: false
# source because it sets up env vars on some platforms
install: source ci/travis/travis_install.sh
env:
  global:
    # Travis can run out of RAM, so we need to be careful here.
    - YCM_CORES=3
    - COVERAGE=true
    - secure: "Niz4EnRgYb2WcU/m8BxMeIKP7v4+iF+XTtnWzczfnKyGqsBcw+Xlosd4J+Rrh3Rqs6nXQJwxkYAsf5Ejo+SOx8Q22uOWFnGqWyJ2CH4+fPHOIIPwbUW4XUvoJvsjabxqBzZXjOYw1mADsDh9wuQ1V9+zOzzXa1MVAE2C/1bi0yc="
    - secure: "jNUJkuIIVQrRrQ3lXton8A31pLZSxU3a1h6Zp/EJX6pq3ZxzwINBkIWNfPaU8Bk9S0iD1yXBQDouP5pLDUggYvR2qz2Xc6MIV+Ip0XT9FeCTeN+ka/sYVCbmkMsfp5rvoTvzSEpFuOA9MXVWFhDCewUocTyYD8WfuBuSHz5cR18="
jobs:
  include:
    - name: Python 2.7
      env: YCM_PYTHON_VERSION=2.7
      script: ./run_tests.py
      after_success: codecov
    - name: Python 3.4
      env: YCM_PYTHON_VERSION=3.4
      script: ./run_tests.py
      after_success: codecov
    - name: Documentation
      if: branch = master
      env: YCM_PYTHON_VERSION=3.4
      script: ./ci/travis/travis_update_docs.sh
addons:
  apt:
    sources:
     # The Travis apt source whitelist can be found here:
     #   https://github.com/travis-ci/apt-source-whitelist/blob/master/ubuntu.json
     - ubuntu-toolchain-r-test  # for new libstdc++
     - george-edison55-precise-backports # for a more recent version of cmake (3.2.3)
    packages:
     - cmake-data
     - cmake
     # 4.8 is the first version of GCC with good enough C++11 support to build
     # ycmd.
     - g++-4.8
     # Everything below is a Python build dep (though it depends on Python
     # version). We need them because pyenv builds Python.
     - libssl-dev
     - zlib1g-dev
     - libbz2-dev
     - libreadline-dev
     - libsqlite3-dev
     - wget
     - curl
     - llvm
     - libncurses5-dev
     - libncursesw5-dev
cache:
  directories:
    - $HOME/.cache/pip  # Python packages from pip
    - $HOME/.pyenv  # pyenv
